
const IchigoJamEncoderTable = {

    recieveStr:[
        "Â±","Â²","Â³","Â´","Âµ",
        "Â¶","Â·","Â¸","Â¹","Âº",
        "Â»","Â¼","Â½","Â¾","Â¿",
        "Ã€","Ã","Ã‚","Ãƒ","Ã„",
        "Ã…","Ã†","Ã‡","Ãˆ","Ã‰",
        "ÃŠ","Ã‹","ÃŒ","Ã","Ã",        
        "Ã","Ã","Ã‘","Ã’","Ã“",
        "Ã”","Ã•","Ã–", 
        "Ã—","Ã˜","Ã™","Ãš","Ã›",
        "Ãœ","Â¦","Ã",

        "Â§","Â¨","Â©","Âª","Â«",
        "Â¯",
        "Â¬","%C2%AD","%C2%AE", //å°æ–‡å­—ã®ãƒ¦ãƒ¨ãŒèª­ã¿å–ã‚Œãªã„ã®ã§ãƒ¦ãƒ‹ã‚³ãƒ¼ãƒ‰ã§å¯¾å¿œ
        "Â¤","Â¡","Â°","Â¢","Â£",

        "Â¶Ã","Â·Ã","Â¸Ã","Â¹Ã","ÂºÃ", 
        "Â»Ã","Â¼Ã","Â½Ã","Â¾Ã","Â¿Ã",
        "Ã€Ã","ÃÃ","Ã‚Ã","ÃƒÃ","Ã„Ã",
        "ÃŠÃ","Ã‹Ã","ÃŒÃ","ÃÃ","ÃÃ",
        "ÃŠÃŸ","Ã‹ÃŸ","ÃŒÃŸ","ÃÃŸ","ÃÃŸ",

        "Ã ","Ã¡","Ã¢","Ã£","Ã¤","Ã¥","Ã¦","Ã§","Ã¨","Ã©","Ãª","Ã«","Ã¬","Ã­","Ã®","Ã¯",
        "Ã°","Ã±","Ã²","Ã³","Ã´","Ãµ","Ã¶","Ã·","Ã¸","Ã¹","Ãº","Ã»","Ã¼","Ã½","Ã¾","Ã¿",

        //èª­ã¿å–ã‚Œãªã„æ–‡å­—åˆ—ã¯ãƒ¦ãƒ‹ã‚³ãƒ¼ãƒ‰ã§å¯¾å¿œ
        "%C2%81","%C2%82","%C2%83","%C2%84","%C2%85","%C2%86","%C2%87","%C2%88","%C2%89","%C2%8A","%C2%8B","%C2%8C","%C2%8D","%C2%8E","%C2%8F","%C2%90","%C2%91","%C2%92","%C2%93","%C2%94","%C2%95","%C2%96","%C2%97","%C2%98","%C2%99","%C2%9A","%C2%9B","%C2%9C","%C2%9D","%C2%9E","%C2%9F"
    ],

    sendStr:[
        "ã‚¢","ã‚¤","ã‚¦","ã‚¨","ã‚ª",
        "ã‚«","ã‚­","ã‚¯","ã‚±","ã‚³",
        "ã‚µ","ã‚·","ã‚¹","ã‚»","ã‚½",
        "ã‚¿","ãƒ","ãƒ„","ãƒ†","ãƒˆ",
        "ãƒŠ","ãƒ‹","ãƒŒ","ãƒ","ãƒ",
        "ãƒ","ãƒ’","ãƒ•","ãƒ˜","ãƒ›",
        "ãƒ","ãƒŸ","ãƒ ","ãƒ¡","ãƒ¢",
        "ãƒ¤","ãƒ¦","ãƒ¨",
        "ãƒ©","ãƒª","ãƒ«","ãƒ¬","ãƒ­",
        "ãƒ¯","ãƒ²","ãƒ³",
        
        "ã‚¡","ã‚£","ã‚¥","ã‚§","ã‚©",
        "ãƒƒ",
        "ãƒ£","ãƒ¥","ãƒ§",
        "ã€","ã€‚","ãƒ¼","ã€Œ","ã€",

        "ã‚¬","ã‚®","ã‚°","ã‚²","ã‚´",
        "ã‚¶","ã‚¸","ã‚º","ã‚¼","ã‚¾",
        "ãƒ€","ãƒ‚","ãƒ…","ãƒ‡","ãƒ‰",
        "ãƒ","ãƒ“","ãƒ–","ãƒ™","ãƒœ",
        "ãƒ‘","ãƒ”","ãƒ—","ãƒš","ãƒ",

        "â†","â†’","â†‘","â†“","â™ ","â™¥","â™£","â™¦","âš«","âšª","ğŸ”Ÿ","ğŸ™","ğŸ±","ğŸ‘¾","â™ª","ğŸŒ€",
        "ğŸš€","ğŸ›¸","âŒ‡","ğŸš","ğŸ’¥","ğŸ’°","ğŸ§°","ğŸ“¶","ğŸšª","ğŸ•´","ğŸ•º","ğŸ’ƒ","ğŸŒ","ğŸƒ","ğŸš¶","ğŸ“",

        "/","/","â–˜","â–","â–€","â––","â–Œ","â–","â–›","â–—","â–š","â–","â–œ","â–„","â–™","â–Ÿ","â–ˆ","ãƒ»","â”","â”ƒ","â•‹","â”«","â”£","â”»","â”³","â”","â”“","â”—","â”›","â—¤","â—¥","â—£","â—¢"
    ]

}

const IchigoJamEncoder = (recMsg,msgUri,icon,iconUri) => {
    const recMsgLength = recMsg.length;
    let encodedMsg = "";
    let encodedIcon = "";
    let d = []; 

    //ã‚¢ã‚¤ã‚³ãƒ³ã®æ–‡å­—ãŒã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆã‚„æ•°å­—ã€ã²ã‚‰ãŒãªã€æ¼¢å­—ã®æ™‚ã¯ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—ãªã„
    if(iconUri.substr(0,2) != "%C"){
        encodedIcon = icon;
    } else {
        //IchigoJamEncoderTableã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å‚ç…§ã—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰
        for(const j in IchigoJamEncoderTable.sendStr){
            if(icon == IchigoJamEncoderTable.recieveStr[j] || encodeURI(icon) == IchigoJamEncoderTable.recieveStr[j]){
                encodedIcon = IchigoJamEncoderTable.sendStr[j];
            } 
        }  
    }
    

    //ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰å‰ã®æ–‡å­—ã‚’1æ–‡å­—ãšã¤åˆ†å‰²ã—ã¦é…åˆ—dã«æ ¼ç´
    for(let i = 0; i < recMsgLength; i++){
        d[i] = recMsg.substr(i,1);
    }

    //1æ–‡å­—ãšã¤ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰
    for(let i = 0; i < recMsgLength; i++){

        //æ¿ç‚¹ã€åŠæ¿ç‚¹ã®æ™‚ã¯ã‚¹ã‚­ãƒƒãƒ—
        if(d[i] == "Ã" || d[i] == "ÃŸ") continue;

        //æ¿ç‚¹æ–‡å­—ã®å‡¦ç†
        if(d[i+1] == "Ã") d[i] = d[i] + "Ã";

        //åŠæ¿ç‚¹æ–‡å­—ã®å‡¦ç†
        if(d[i+1] == "ÃŸ") d[i] = d[i] + "ÃŸ";

        //ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆã‚„æ•°å­—ã€ã²ã‚‰ãŒãªã€æ¼¢å­—ã®æ™‚ã¯ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã›ãšé€£çµ
        if(encodeURI(d[i]).substr(0,2) != "%C"){
            encodedMsg = encodedMsg + d[i];
            continue;
        }

        //IchigoJamEncoderTableã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å‚ç…§ã—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰
        for(const j in IchigoJamEncoderTable.sendStr){
            if(d[i] == IchigoJamEncoderTable.recieveStr[j] || encodeURI(d[i]) == IchigoJamEncoderTable.recieveStr[j]){
                encodedMsg = encodedMsg + IchigoJamEncoderTable.sendStr[j];
            } 
        }            
        

    } 
    let encodedStr = {msg:encodedMsg, icon:encodedIcon};
    return encodedStr;
}

module.exports = IchigoJamEncoder;

